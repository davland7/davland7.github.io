---
import type { RadioStation } from '../lib/types';

interface Props {
	station: RadioStation;
}

const { station } = Astro.props;
const { name, url, country, countrycode, tags, language, codec, bitrate, hls } = station;

const getRPlayerUrl = (url: string) => {
	return `https://rplayer.js.org/?url=${encodeURIComponent(url)}`;
};

const rplayerUrl = getRPlayerUrl(url);

const jsonLd = {
	"@context": "https://schema.org",
	"@type": "RadioStation",
	"name": name,
	"broadcastFrequency": codec && bitrate > 0 ? `${codec} ${bitrate}kbps` : undefined,
	"url": url,
	"genre": tags.join(", "),
	"inLanguage": language.join(", "),
	"areaServed": country || undefined
};
---

<script is:inline type="application/ld+json" set:html={JSON.stringify(jsonLd)} />

<div class="station-card">
	<div class="station-header">
		<h2>{name}</h2>
	</div>

	<div class="station-specs">
		{country && (
			<span class="badge badge-country">
				{countrycode && <span class={`fi fi-${countrycode}`}></span>}
				{country}
			</span>
		)}
		{tags.map((tag) => (
			<span class="badge badge-genre">{tag}</span>
		))}
		{language.map((lang) => (
			<span class="badge badge-lang">{lang}</span>
		))}
		{codec && codec !== "Unknown" && (
			<span class="badge badge-codec">{codec}</span>
		)}
		{bitrate > 0 && (
			<span class="badge badge-bitrate">{bitrate} kbps</span>
		)}
		{hls === 1 && <span class="badge badge-hls">HLS</span>}
	</div>

	<div class="station-actions">
		<button
      onclick={`navigator.clipboard.writeText('${url}'); alert('URL copied!')`}
    >
      Copy URL
    </button>
    <a href={rplayerUrl} target="rplayer">
      Test
    </a>
	</div>
</div>

<style>
	.station-card {
    display: flex;
		flex-direction: column;
		border-radius: var(--space-md);
		padding: var(--space-lg);
		background: var(--color-surface);
		width: 100%;
		height: 100%;
		min-height: 200px;
	}

	.station-header {
		margin-bottom: var(--space-lg);
	}

	.station-header h2 {
		margin: 0;
		font-size: 18px;
		font-weight: 700;
	}

	.station-specs {
		display: flex;
		gap: var(--space-md);
		flex-wrap: wrap;
		margin-bottom: var(--space-lg);
	}

	.badge {
		display: inline-block;
		padding: var(--space-sm) var(--space-md);
		background: var(--color-background);
		border: none;
		border-radius: var(--space-sm);
		font-size: 12px;
		font-weight: 600;
		color: var(--color-text);
	}

	.badge-country {
		background: white;
		color: var(--color-black);
	}

	.badge-genre {
		background: #d1e7ff;
		color: #1a1a1a;
	}

	.badge-lang {
		background: #ffe4b3;
		color: #1a1a1a;
	}
	.badge-codec {
		background: #e8d4f1;
		color: #1a1a1a;
	}

	.badge-bitrate {
		background: #d4f1e8;
		color: #1a1a1a;
	}
	.badge-hls {
		background: var(--color-green);
		color: black;
	}

	.badge-more {
		opacity: 0.7;
	}

	.station-actions {
		display: flex;
    justify-content: space-between;
		gap: var(--space-md);
		margin-top: auto;
	}
</style>
